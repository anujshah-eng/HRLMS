<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #4f46e5;
        /* Indigo 600 */
        --primary-hover: #4338ca;
        /* Indigo 700 */
        --danger: #ef4444;
        /* Red 500 */
        --danger-hover: #dc2626;
        /* Red 600 */
        --success: #10b981;
        /* Emerald 500 */
        --surface: #ffffff;
        --background: #f3f4f6;
        /* Gray 100 */
        --text-main: #1f2937;
        /* Gray 800 */
        --text-muted: #6b7280;
        /* Gray 500 */
        --border: #e5e7eb;
        /* Gray 200 */
        --radius-lg: 16px;
        --radius-md: 10px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --font-main: 'Inter', system-ui, -apple-system, sans-serif;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        outline: none;
    }

    body {
        font-family: var(--font-main);
        background-color: var(--background);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        /* align-items: center; */
        /* Removed for live mode */
        padding: 2rem;
        padding-top: 6rem;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
        /* Added for live mode */
    }

    /* Sidebar for Configuration */
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 400px;
        /* Wider sidebar */
        height: 100vh;
        background: white;
        z-index: 3000;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    .sidebar.open {
        transform: translateX(0);
    }

    .sidebar-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .sidebar-content {
        flex: 1;
        padding: 1.5rem;
        overflow-y: auto;
    }

    .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2900;
        display: none;
        backdrop-filter: blur(2px);
    }

    .sidebar-overlay.open {
        display: block;
    }

    /* Full page layout for Live Mode */
    body.live-mode {
        padding: 0;
        overflow: hidden;
    }

    body.live-mode .navbar,
    body.live-mode #setup-view {
        /* Changed from .container to #setup-view */
        display: none;
    }

    /* Live Interface (Default View Now) */
    #live-interface {
        display: flex;
        /* Always visible */
        width: 100vw;
        height: 100vh;
        background: #0f172a;
        color: white;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 100;
        /* Behind sidebar */
    }

    .navbar {
        display: none;
    }

    /* Hide old navbar */

    /* Adjust Live Layout z-indexing */
    .live-main-area {
        z-index: 1;
    }

    .live-layout {
        display: flex;
        width: 100%;
        height: 100%;
    }

    /* Left Side: AI & User Cam */
    .live-main-area {
        flex: 2.5;
        /* 70% width approx */
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        border-right: 1px solid #334155;
    }

    /* AI Avatar */
    .ai-avatar-container {
        position: relative;
        width: 200px;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 50px;
    }

    .ai-circle {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        box-shadow: 0 0 50px rgba(99, 102, 241, 0.5);
        animation: pulse-glow 3s infinite ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        font-weight: bold;
    }

    .speaking-ring {
        position: absolute;
        inset: -20px;
        border: 2px solid rgba(99, 102, 241, 0.3);
        border-radius: 50%;
        animation: ripple 2s infinite linear;
        opacity: 0;
    }

    /* User Cam - PIP Style (Bottom Right of Left Panel) */
    .user-cam-pip {
        position: absolute;
        bottom: 30px;
        right: 30px;
        width: 280px;
        aspect-ratio: 4/3;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        border: 2px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    /* Controls Overlay in Live Mode */
    .live-controls {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        background: rgba(0, 0, 0, 0.6);
        padding: 15px 25px;
        border-radius: 50px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .control-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        transition: all 0.2s ease;
        color: white;
        padding: 0;
        line-height: 1;
    }

    .btn-mute {
        background: #374151;
    }

    .btn-mute:hover {
        background: #4b5563;
    }

    .btn-mute.active {
        background: #ef4444;
    }

    .btn-end {
        background: #ef4444;
    }

    .btn-end:hover {
        background: #dc2626;
        transform: scale(1.1);
    }

    /* Right Side: Transcript */
    .live-transcript-area {
        flex: 1;
        /* 30% width */
        background: #f8fafc;
        /* Keep light theme for readability or go dark? User requested wireframe which looked whiteish */
        display: flex;
        flex-direction: column;
        border-left: 1px solid #e2e8f0;
    }

    .live-transcript-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e2e8f0;
        background: white;
        font-weight: 600;
        color: #1e293b;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .live-transcript-content {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    @keyframes pulse-glow {

        0%,
        100% {
            transform: scale(1);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        50% {
            transform: scale(1.05);
            box-shadow: 0 0 60px rgba(99, 102, 241, 0.6);
        }
    }

    @keyframes ripple {
        0% {
            transform: scale(1);
            opacity: 0.8;
        }

        100% {
            transform: scale(1.5);
            opacity: 0;
        }
    }

    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-sm);
        display: flex;
        align-items: center;
        padding: 0 2rem;
        z-index: 1000;
        border-bottom: 1px solid var(--border);
    }

    .navbar-brand {
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--text-main);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .brand-icon {
        color: var(--primary);
        font-size: 1.5rem;
    }

    .container {
        background: var(--surface);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        max-width: 900px;
        width: 100%;
        padding: 3rem;
        border: 1px solid rgba(255, 255, 255, 0.5);
        transition: transform 0.3s ease;
    }

    h1 {
        font-weight: 700;
        font-size: 1.875rem;
        color: var(--text-main);
        text-align: center;
        margin-bottom: 0.5rem;
        letter-spacing: -0.025em;
    }

    .subtitle {
        text-align: center;
        color: var(--text-muted);
        margin-bottom: 2.5rem;
        font-size: 0.95rem;
    }

    /* Main Grid Layout */
    .main-grid-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 20px;
    }

    .config-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        /* Remove margin-bottom as it is handled by grid gap */
    }

    @media (max-width: 900px) {
        .main-grid-layout {
            grid-template-columns: 1fr;
        }
    }

    /* Transcript Area - Adjusted for Side Layout */
    .transcript-wrapper {
        background: #f9fafb;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        height: 500px;
        /* Increased height */
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        scroll-behavior: smooth;
    }

    .section-title {
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.5rem;
    }

    .input-group {
        margin-bottom: 1.25rem;
    }

    .input-group label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-main);
        margin-bottom: 0.5rem;
    }

    input,
    select,
    textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 0.95rem;
        background: #f9fafb;
        transition: all 0.2s;
        color: var(--text-main);
    }

    input:disabled {
        background: #f3f4f6;
        color: var(--text-muted);
        cursor: not-allowed;
    }

    input:focus,
    select:focus,
    textarea:focus {
        border-color: var(--primary);
        background: white;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    /* Device Check Card */
    .device-card {
        background: #f9fafb;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* Floating Device Panel - Top Right */
    .floating-device-panel {
        position: fixed;
        top: 90px;
        right: 30px;
        width: 260px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-radius: var(--radius-md);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.5);
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .video-window {
        width: 100%;
        aspect-ratio: 4/3;
        background: #111827;
        border-radius: var(--radius-md);
        overflow: hidden;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        position: relative;
    }

    #localVideo {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
        display: none;
    }

    .camera-placeholder {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #9ca3af;
        gap: 0.75rem;
    }

    .preview-icon {
        font-size: 2rem;
        opacity: 0.5;
    }

    button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        font-size: 0.95rem;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
    }

    .btn-primary:not(:disabled):hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .btn-danger {
        background: var(--danger);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.2);
    }

    .btn-danger:not(:disabled):hover {
        background: var(--danger-hover);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: white;
        border: 1px solid var(--border);
        color: var(--text-main);
        width: 100%;
        font-size: 0.875rem;
        padding: 0.6rem;
    }

    .btn-secondary:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }

    /* Status Bar */
    .status-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.5rem;
        background: #f0f9ff;
        border: 1px solid #e0f2fe;
        border-radius: var(--radius-md);
        color: #0369a1;
        margin-bottom: 2rem;
        font-size: 0.9rem;
    }

    .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #94a3b8;
    }

    .status-dot.connected {
        background-color: var(--success);
        box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
    }

    /* Transcript Area */
    /* The previous .transcript-wrapper definition was merged and updated above */

    .transcript-header {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .message {
        max-width: 80%;
        padding: 1rem;
        font-size: 0.95rem;
        line-height: 1.6;
        animation: fadeIn 0.3s ease;
        border-radius: 16px;
        /* Default for live mode */
    }

    .message.user {
        align-self: flex-end;
        background: rgb(79, 70, 229);
        /* Primary color */
        color: white;
        border-radius: 16px 16px 0 16px;
        box-shadow: 0 2px 4px rgba(79, 70, 229, 0.15);
    }

    .message.ai {
        align-self: flex-start;
        background: white;
        border: 1px solid var(--border);
        color: var(--text-main);
        border-radius: 16px 16px 16px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }

    .message-label {
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
        opacity: 0.8;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .controls {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 1.5rem;
        border-top: 1px solid var(--border);
        padding-top: 1.5rem;
    }

    /* Utilities */
    .hidden {
        display: none !important;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Info/Error Banner Styles */
    .banner {
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        display: none;
    }

    .banner.error {
        background-color: #fef2f2;
        color: #991b1b;
        border: 1px solid #fee2e2;
    }

    .banner.success {
        background-color: #ecfdf5;
        color: #065f46;
        border: 1px solid #d1fae5;
    }

    /* Custom Scrollbar */
    .transcript-wrapper::-webkit-scrollbar {
        width: 6px;
    }

    .transcript-wrapper::-webkit-scrollbar-track {
        background: transparent;
    }

    .transcript-wrapper::-webkit-scrollbar-thumb {
        background-color: #d1d5db;
        border-radius: 20px;
    }

    /* Toast Notifications - Fixed Bottom Right */
    .toast-container {
        position: fixed;
        bottom: 30px;
        right: 30px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 2000;
    }

    .toast-notification {
        background: white;
        padding: 1rem 1.5rem;
        border-radius: var(--radius-md);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary);
        font-size: 0.9rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 300px;
        animation: slideIn 0.3s ease forwards;
        opacity: 0;
        transform: translateX(100%);
    }

    .toast-notification.warning {
        border-left-color: #f59e0b;
    }

    @keyframes slideIn {
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes fadeOut {
        to {
            opacity: 0;
            transform: translateX(100%);
        }
    }

    /* JS Compatibility Classes */
    .device-status-text {
        font-weight: 600;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        text-align: center;
    }

    .status-ok {
        color: var(--success);
    }

    .status-err {
        color: var(--danger);
    }
</style>
</head>

<body>
    <!-- Sidebar Configuration -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="configSidebar">
        <div class="sidebar-header">
            <h2 style="font-size:1.25rem; font-weight:700; color:#111827">Interview Setup</h2>
            <button id="closeSidebarBtn"
                style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#6b7280;">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="input-group">
                <label>Candidate Name</label>
                <input type="text" id="candidateName" value="Nagarjun">
            </div>

            <div class="input-group">
                <label>Role</label>
                <select id="role">
                    <option value="">Loading roles...</option>
                </select>
            </div>

            <div class="input-group">
                <label>Duration (minutes)</label>
                <input type="number" id="duration" value="5" min="1" max="60">
            </div>

            <div class="input-group">
                <label>Interviewer Persona</label>
                <select id="interviewer">
                    <option value="">Loading interviewers...</option>
                </select>
            </div>

            <!-- New Fields for Full API Support -->
            <div class="input-group">
                <label>Skills (comma separated)</label>
                <textarea id="skills" rows="3" placeholder="e.g. React, Python, AWS"></textarea>
            </div>

            <div class="input-group">
                <label>Job Description</label>
                <textarea id="jobDescription" rows="3" placeholder="Paste JD here..."></textarea>
            </div>

            <div class="input-group">
                <label>Questions (one per line)</label>
                <textarea id="questions" rows="3" placeholder="Enter specific questions..."></textarea>
            </div>

            <div style="margin-top:2rem;">
                <button class="btn-primary" id="saveConfigBtn" style="width:100%">
                    Save & Close
                </button>
            </div>

            <div
                style="margin-top:2rem; padding:1rem; background:#f3f4f6; border-radius:8px; font-size:0.85rem; color:#6b7280;">
                <p><strong>Device Check:</strong></p>
                <button class="btn-secondary" id="checkDevicesBtnSidebar"
                    style="width:100%; margin-top:0.5rem; justify-content:center;">
                    Test Camera/Mic
                </button>
                <div id="deviceStatusText" class="device-status-text"></div>
            </div>
        </div>
    </div>

    <!-- LIVE INTERFACE (Default) -->
    <div id="live-interface">
        <div class="live-layout">
            <!-- Left: Live Interaction Area -->
            <div class="live-main-area">
                <!-- Top Nav in Live View -->
                <div style="position:absolute; top:20px; left:20px; z-index:10; display:flex; gap:10px;">
                    <button class="btn-secondary" id="openSidebarBtn"
                        style="background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(5px);">
                        ‚öôÔ∏è Settings
                    </button>
                    <div
                        style="background:rgba(255,255,255,0.1); padding:0.5rem 1rem; border-radius:6px; backdrop-filter:blur(5px); display:flex; align-items:center; gap:0.5rem; border:1px solid rgba(255,255,255,0.2);">
                        <span
                            style="width:8px; height:8px; background:#10b981; border-radius:50%; display:block;"></span>
                        <span style="font-size:0.85rem; font-weight:500;">AI Readiness: Connected</span>
                    </div>
                </div>

                <!-- AI Avatar -->
                <div class="ai-avatar-container">
                    <div class="speaking-ring"></div>
                    <div class="ai-circle">AI</div>
                    <div style="position:absolute; bottom:-40px; font-weight:600; opacity:0.8">Interviewer</div>
                </div>

                <!-- User Cam Container -->
                <div id="liveUserCamContainer" class="user-cam-pip">
                    <video id="localVideo" autoplay playsinline muted
                        style="width:100%; height:100%; object-fit:cover; transform:scaleX(-1);"></video>
                    <div class="camera-placeholder" id="cameraPlaceholder"
                        style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#9ca3af; background:#111827;">
                        <div class="preview-icon">üì∑</div>
                        <div>Camera Off</div>
                    </div>
                </div>

                <!-- Live Controls -->
                <div class="live-controls">
                    <button class="control-btn" id="checkDevicesBtnMain" title="Test Camera & Mic"
                        style="background:#4b5563;">
                        üõ†
                    </button>
                    <button class="control-btn btn-mute" id="camBtn" title="Toggle Camera">üì∑</button>
                    <button class="control-btn btn-mute" id="muteBtn" title="Mute Mic">üé§</button>

                    <!-- Start Button (Visible initially) -->
                    <button class="control-btn" id="startBtn" title="Start Interview"
                        style="background:#10b981; width:auto; padding:0 25px; border-radius:30px; font-weight:600; font-size:1rem; gap:8px;">
                        <span>‚ñ∂</span> Start
                    </button>

                    <!-- End Button (Hidden initially) -->
                    <button class="control-btn btn-end hidden" id="liveStopBtn" title="End Call">üìû</button>
                </div>

                <!-- View Results (Hidden initially) -->
                <!-- View Results (Top Right) -->
                <div style="position:absolute; top:20px; right:20px; z-index:20;">
                    <button id="viewResultsBtn" class="btn-primary hidden"
                        style="background-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        View Results
                    </button>
                </div>
            </div>

            <!-- Right: Transcript -->
            <div class="live-transcript-area">
                <div class="live-transcript-header">
                    <div>Transcript</div>
                    <div id="liveTimerDisplay" style="font-family:monospace; font-weight:700; color:var(--primary)">
                        00:00</div>
                </div>
                <div id="liveTranscriptContent" class="live-transcript-content">
                    <div style="text-align:center; color:#9ca3af; margin-top:2rem; font-style:italic;">
                        Ready to start. Click 'Start' to begin.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Permission Help Overlay -->
    <div id="permissionOverlay"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:200; align-items:center; justify-content:center; flex-direction:column; text-align:center; color:white;">
        <div style="font-size:3rem; margin-bottom:1rem;">üì∑ üé§</div>
        <h2 style="margin-bottom:0.5rem;">Camera & Microphone Access Needed</h2>
        <p style="color:#d1d5db; margin-bottom:2rem; max-width:400px;">Please click "Allow" in your browser popup to
            enable your camera and microphone for the interview.</p>
        <button class="btn-primary" onclick="app.checkDevices()">Try Again</button>
    </div>

    <script>
        // ... (existing script start)
        // Configuration
        const FASTAPI_BASE_URL = 'http://localhost:8001';
        const NODEJS_BASE_URL = 'http://localhost:3000';

        class MockInterviewWebRTC {
            constructor() {
                this.peerConnection = null;
                this.dataChannel = null;
                this.audioElement = null;
                this.isConnected = false;
                this.sessionId = null;
                this.currentAITranscript = '';

                this.interviewStartTime = null;
                this.interviewTimer = null;
                this.durationMinutes = 15;
                this.interviewers = [];
                this.conversationHistory = [];
                this.localStream = null;
                this.devicesReady = false;
                this.isMuted = false;

                this.startBtn = document.getElementById('startBtn');
                this.liveStopBtn = document.getElementById('liveStopBtn');
                this.viewResultsBtn = document.getElementById('viewResultsBtn');
                this.muteBtn = document.getElementById('muteBtn');
                this.camBtn = document.getElementById('camBtn');

                this.isCameraOff = false;

                // Sidebar Elements
                this.configSidebar = document.getElementById('configSidebar');
                this.sidebarOverlay = document.getElementById('sidebarOverlay');
                this.openSidebarBtn = document.getElementById('openSidebarBtn');
                this.closeSidebarBtn = document.getElementById('closeSidebarBtn');
                this.saveConfigBtn = document.getElementById('saveConfigBtn');


                this.transcriptContent = document.getElementById('liveTranscriptContent');
                this.timerDisplay = document.getElementById('liveTimerDisplay');

                this.interviewerSelect = document.getElementById('interviewer');
                this.roleSelect = document.getElementById('role');

                this.localVideo = document.getElementById('localVideo');
                this.cameraPlaceholder = document.getElementById('cameraPlaceholder');

                // Sidebar Device check
                this.checkDevicesBtn = document.getElementById('checkDevicesBtnSidebar');
                this.checkDevicesBtnMain = document.getElementById('checkDevicesBtnMain');
                this.deviceStatusText = document.getElementById('deviceStatusText');

                this.initEventListeners();
                this.loadInterviewers();
                this.loadRoles();
                this.checkServerHealth();
                this.checkDevices(); // Auto-check on load if possible since we are in live view
            }

            initEventListeners() {
                this.startBtn.addEventListener('click', () => this.startInterview());
                this.liveStopBtn.addEventListener('click', () => this.stopInterview());
                this.viewResultsBtn.addEventListener('click', () => this.openResults());
                this.muteBtn.addEventListener('click', () => this.toggleMute());

                // Sidebar Logic
                this.openSidebarBtn.addEventListener('click', () => this.toggleSidebar(true));
                this.closeSidebarBtn.addEventListener('click', () => this.toggleSidebar(false));
                this.sidebarOverlay.addEventListener('click', () => this.toggleSidebar(false));
                this.saveConfigBtn.addEventListener('click', () => this.toggleSidebar(false));

                // Device check in sidebar
                this.checkDevicesBtn.addEventListener('click', () => this.checkDevices());
                if (this.checkDevicesBtnMain) this.checkDevicesBtnMain.addEventListener('click', () => this.checkDevices());

                this.camBtn.addEventListener('click', () => this.toggleCamera());
            }

            toggleCamera() {
                if (this.localStream) {
                    const videoTrack = this.localStream.getVideoTracks()[0];
                    if (videoTrack) {
                        this.isCameraOff = !this.isCameraOff;
                        videoTrack.enabled = !this.isCameraOff;
                        this.camBtn.textContent = this.isCameraOff ? 'üö´' : 'üì∑';
                        this.camBtn.classList.toggle('active', this.isCameraOff);

                        // Toggle placeholder visibility
                        if (this.isCameraOff) {
                            this.cameraPlaceholder.style.display = 'flex';
                            this.localVideo.style.opacity = '0';
                        } else {
                            this.cameraPlaceholder.style.display = 'none';
                            this.localVideo.style.opacity = '1';
                        }
                    }
                }
            }

            toggleSidebar(open) {
                if (open) {
                    this.configSidebar.classList.add('open');
                    this.sidebarOverlay.classList.add('open');
                } else {
                    this.configSidebar.classList.remove('open');
                    this.sidebarOverlay.classList.remove('open');
                }
            }

            async loadRoles() {
                // Endpoint removed from backend, using static data
                const roles = [
                    { id: "1", title: "Software Trainee" },
                    { id: "2", title: "Software Engineer" },
                    { id: "3", title: "Senior Software Engineer" },
                    { id: "4", title: "AI/ML Engineer" },
                    { id: "5", title: "Product Manager" }
                ];

                this.roleSelect.innerHTML = roles.map(role =>
                    `<option value="${role.id}">${role.title}</option>`
                ).join('');

                // Select default
                this.roleSelect.value = "1";
            }

            async loadInterviewers() {
                // Endpoint removed from backend, using static data
                this.interviewers = [
                    { id: "1", name: "Priya Sharma", gender: "Female", accent: "Indian English" },
                    { id: "2", name: "Sarah Johnson", gender: "Female", accent: "US English" },
                    { id: "3", name: "Arjun Patel", gender: "Male", accent: "Indian English" },
                    { id: "4", name: "Michael Chen", gender: "Male", accent: "US English" }
                ];
                this.populateInterviewerDropdown();
            }

            populateInterviewerDropdown() {
                this.interviewerSelect.innerHTML = this.interviewers.map(interviewer =>
                    `<option value="${interviewer.id}">${interviewer.name} (${interviewer.gender}, ${interviewer.accent})</option>`
                ).join('');
            }

            async checkServerHealth() {
                try {
                    const response = await fetch(`${FASTAPI_BASE_URL}/`);
                    const data = await response.json();

                    if (data.message) {
                        console.log('FastAPI server connected');
                    }
                } catch (error) {
                    this.showError('Cannot connect to FastAPI server. Please ensure it is running on port 8001.');
                }
            }

            async checkDevices() {
                this.showToast('Checking camera and microphone...', 'default');
                try {
                    this.deviceStatusText.textContent = 'Requesting access...';
                    this.deviceStatusText.className = 'device-status-text';

                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: true,
                        video: {
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            facingMode: "user"
                        }
                    });

                    this.localStream = stream;
                    this.localVideo.srcObject = stream;
                    this.localVideo.style.display = 'block';
                    this.cameraPlaceholder.style.display = 'none';

                    this.devicesReady = true;
                    this.deviceStatusText.textContent = '‚úÖ Camera & Microphone connected';
                    this.deviceStatusText.className = 'device-status-text status-ok';

                    this.checkDevicesBtn.innerHTML = '<span>‚úÖ</span> Devices Ready';
                    this.checkDevicesBtn.style.background = '#4caf50';
                    if (this.checkDevicesBtnMain) {
                        this.checkDevicesBtnMain.innerHTML = '<span>‚úÖ</span>';
                        this.checkDevicesBtnMain.style.background = '#4caf50';
                    }

                    this.showToast('‚úÖ Devices Working Properly', 'success');

                    // Hide Permission Overlay if visible
                    const permOverlay = document.getElementById('permissionOverlay');
                    if (permOverlay) permOverlay.style.display = 'none';

                } catch (error) {
                    console.error('Device check failed:', error);
                    this.devicesReady = false;
                    this.deviceStatusText.textContent = '‚ùå Access denied or device not found';
                    this.deviceStatusText.className = 'device-status-text status-err';
                    this.showError('Camera/Microphone access is required. ' + error.message);

                    if (this.checkDevicesBtnMain) {
                        this.checkDevicesBtnMain.innerHTML = '<span>‚ö†Ô∏è</span>';
                        this.checkDevicesBtnMain.style.background = '#ef4444';
                    }

                    // Show permission overlay if likely a permission issue
                    const permOverlay = document.getElementById('permissionOverlay');
                    if (permOverlay && (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError')) {
                        permOverlay.style.display = 'flex';
                    }
                }
            }

            validateInputs() {
                const name = document.getElementById('candidateName').value.trim();
                const interviewerId = this.interviewerSelect.value;

                if (!name) {
                    throw new Error('Please enter your name');
                }

                if (!interviewerId) {
                    throw new Error('Please select an interviewer');
                }

                if (!this.devicesReady) {
                    throw new Error('Please test your camera and microphone first');
                }

                return { name, interviewerId };
            }

            async startInterview() {
                try {
                    const { name, interviewerId } = this.validateInputs();

                    this.startBtn.disabled = true;
                    this.startBtn.innerHTML = '<span class="loading"></span> Connecting...';
                    this.updateStatus('Connecting...', false);
                    this.viewResultsBtn.classList.add('hidden');

                    const roleId = this.roleSelect.value;
                    const roleName = this.roleSelect.options[this.roleSelect.selectedIndex].text;
                    this.durationMinutes = parseInt(document.getElementById('duration').value);

                    // Close sidebar if open
                    this.toggleSidebar(false);

                    // Clear Previous Transcript
                    this.transcriptContent.innerHTML = '<div style="text-align:center; color:#9ca3af; margin-top:2rem; font-style:italic;">Conversation started...</div>';

                    // Create FormData for FastAPI multipart/form-data endpoint
                    const formData = new FormData();
                    formData.append('role_title', roleName);
                    formData.append('duration_minutes', this.durationMinutes);
                    formData.append('interviewer_id', interviewerId);
                    formData.append('microphone_status', true);
                    formData.append('camera_status', true);

                    // Optional params from sidebar inputs
                    const jobDescription = document.getElementById('jobDescription').value.trim();
                    const skills = document.getElementById('skills').value.trim();
                    const questionsText = document.getElementById('questions').value.trim();

                    if (jobDescription) formData.append('job_description', jobDescription);

                    if (skills) {
                        // Send as JSON array string: "['React', 'Node']" or just comma separated string depending on backend expectation. 
                        // Backend expects JSON string of list[str] OR comma-separated. The python code handles both but let's try to be clean.
                        // Simple comma split
                        const skillsList = skills.split(',').map(s => s.trim()).filter(s => s.length > 0);
                        formData.append('skills', JSON.stringify(skillsList));
                    }

                    if (questionsText) {
                        // Backend expects JSON string of list[dict] or list[str]. 
                        // Let's assume user types one question per line for simplicity and we convert to list of strings
                        const questionsList = questionsText.split('\n').map(q => q.trim()).filter(q => q.length > 0);
                        formData.append('questions', JSON.stringify(questionsList));
                    }



                    const sessionResponse = await fetch(`${FASTAPI_BASE_URL}/aiInterviewManagement/realtime-interview/session`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!sessionResponse.ok) {
                        const errorData = await sessionResponse.json();
                        throw new Error(errorData.Message || 'Failed to create session');
                    }

                    const result = await sessionResponse.json();

                    if (!result.Success) {
                        throw new Error(result.Message || 'Failed to create session');
                    }

                    const sessionData = result.Data;
                    this.sessionId = sessionData.session_id;

                    await this.initWebRTC(sessionData.ephemeral_token);

                    this.liveStopBtn.classList.remove('hidden');
                    this.startBtn.classList.add('hidden');

                    // this.sessionInfo.textContent = `Session ID: ${this.sessionId} | Candidate: ${name}`;
                    // this.startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span> Start Interview'; // Not needed as btn is hidden

                    this.startInterviewTimer();

                } catch (error) {
                    console.error('Error starting interview:', error);
                    this.showError(`Failed to start: ${error.message}`);
                    this.startBtn.disabled = false;
                    this.startBtn.innerHTML = '<span>‚ñ∂</span> Start';
                    this.liveStopBtn.classList.add('hidden');
                    this.startBtn.classList.remove('hidden');
                }
            }

            startInterviewTimer() {
                this.interviewStartTime = Date.now();
                const endTime = this.interviewStartTime + (this.durationMinutes * 60 * 1000);

                this.interviewTimer = setInterval(() => {
                    const now = Date.now();
                    const remaining = endTime - now;

                    if (remaining <= 0) {
                        clearInterval(this.interviewTimer);
                        this.interviewTimer = null;
                        this.timerDisplay.textContent = 'Time expired - Please wrap up';
                        this.timerDisplay.style.color = '#f44336';
                        this.timerDisplay.style.fontWeight = '600';

                        // Send a message to AI to wrap up gracefully
                        if (this.isConnected) {
                            this.sendEvent({
                                type: 'conversation.item.create',
                                item: {
                                    type: 'message',
                                    role: 'user',
                                    content: [{
                                        type: 'input_text',
                                        text: '[System: The allocated interview time has ended. Please wrap up the conversation professionally by thanking the candidate and providing next steps.]'
                                    }]
                                }
                            });

                            this.sendEvent({
                                type: 'response.create'
                            });
                        }

                        this.showSuccess('Interview time completed! The AI will wrap up the conversation.');
                        return;
                    }

                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    this.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    this.timerDisplay.style.color = 'var(--primary)'; // Reset color if it was red

                    // 2 minute warning
                    if (remaining <= 120000 && remaining > 119000 && !this.twoMinuteWarningShown) {
                        this.twoMinuteWarningShown = true;
                        this.showToast('‚ö†Ô∏è 2 Minutes Remaining', 'warning');
                    }

                    // 1 minute warning
                    if (remaining <= 60000 && !this.oneMinuteWarningShown) {
                        this.oneMinuteWarningShown = true;
                        this.showToast('‚ö†Ô∏è 1 Minute Remaining', 'warning');

                        // Notify AI to start wrapping up
                        if (this.isConnected) {
                            this.sendEvent({
                                type: 'conversation.item.create',
                                item: {
                                    type: 'message',
                                    role: 'user',
                                    content: [{
                                        type: 'input_text',
                                        text: '[System: One minute remaining. Start concluding the interview in the next response.]'
                                    }]
                                }
                            });
                        }
                    }
                }, 1000);
            }

            async initWebRTC(ephemeralToken) {
                this.peerConnection = new RTCPeerConnection();
                this.audioElement = document.createElement('audio');
                this.audioElement.autoplay = true;

                this.peerConnection.ontrack = (event) => {
                    console.log('Received remote track:', event.track.kind);
                    this.audioElement.srcObject = event.streams[0];
                };

                this.peerConnection.onconnectionstatechange = () => {
                    console.log('Connection state:', this.peerConnection.connectionState);
                    if (this.peerConnection.connectionState === 'failed') {
                        this.showError('WebRTC connection failed');
                        this.stopInterview();
                    }
                };

                this.dataChannel = this.peerConnection.createDataChannel('oai-events');

                this.dataChannel.onopen = () => {
                    console.log('Data channel opened');
                    this.isConnected = true;
                    // this.updateStatus('Connected - Ready to speak!', true); // Removed status bar
                    this.sendSessionUpdate();
                };

                this.dataChannel.onclose = () => {
                    console.log('Data channel closed');
                    this.isConnected = false;
                    // this.updateStatus('Disconnected', false); // Removed status bar
                };

                this.dataChannel.onerror = (error) => {
                    console.error('Data channel error:', error);
                    this.showError('Data channel error occurred');
                };

                this.dataChannel.onmessage = (event) => {
                    try {
                        const serverEvent = JSON.parse(event.data);
                        this.handleServerEvent(serverEvent);
                    } catch (error) {
                        console.error('Error parsing server event:', error);
                    }
                };

                // Use the existing stream if available from the check
                let stream = this.localStream;
                if (!stream) {
                    stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true
                        },
                        // We also add video now since we checked it
                        video: {
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            facingMode: "user"
                        }
                    });
                    this.localStream = stream;
                    // Update preview if not already showing
                    this.localVideo.srcObject = stream;
                    this.localVideo.style.display = 'block';
                    this.cameraPlaceholder.style.display = 'none';
                }

                stream.getTracks().forEach(track => {
                    if (track.kind === 'audio') {
                        this.peerConnection.addTrack(track, stream);
                    }
                });

                const offer = await this.peerConnection.createOffer();
                await this.peerConnection.setLocalDescription(offer);

                const sdpResponse = await fetch('https://api.openai.com/v1/realtime', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${ephemeralToken}`,
                        'Content-Type': 'application/sdp'
                    },
                    body: offer.sdp
                });

                if (!sdpResponse.ok) {
                    throw new Error('Failed to connect to OpenAI Realtime API');
                }

                const answerSdp = await sdpResponse.text();
                await this.peerConnection.setRemoteDescription({
                    type: 'answer',
                    sdp: answerSdp
                });

                console.log('WebRTC connection established');
            }

            sendSessionUpdate() {
                const name = document.getElementById('candidateName').value;
                const roleName = this.roleSelect.options[this.roleSelect.selectedIndex].text;

                const instructions = `You are an AI interviewer conducting a technical interview for the position of ${roleName}.
The candidate's name is ${name}.
The interview should last approximately ${this.durationMinutes} minutes.

Start by greeting ${name} warmly and asking them to introduce themselves briefly.
Then proceed with relevant questions based on the role.
Be professional, encouraging, and provide constructive feedback when appropriate.
Ask follow-up questions to dive deeper into their responses.
Keep track of time and ensure you cover key areas within the ${this.durationMinutes}-minute timeframe.
At the end, thank them and let them know they'll hear back soon.`;

                this.sendEvent({
                    type: 'session.update',
                    session: {
                        instructions: instructions,
                        input_audio_transcription: {
                            model: 'whisper-1'
                        },
                        turn_detection: {
                            type: 'server_vad',
                            threshold: 0.3, //lower threshold for late detection
                            prefix_padding_ms: 300,
                            silence_duration_ms: 1500
                        }
                    }
                });

                this.sendEvent({
                    type: 'response.create'
                });
            }

            sendEvent(event) {
                if (this.dataChannel && this.dataChannel.readyState === 'open') {
                    this.dataChannel.send(JSON.stringify(event));
                    console.log('Sent event:', event.type);
                }
            }

            handleServerEvent(event) {
                console.log('Server event:', event.type);

                switch (event.type) {
                    case 'session.created':
                        console.log('Session created:', event.session);
                        break;

                    case 'session.updated':
                        console.log('Session updated');
                        break;

                    case 'conversation.item.created':
                        if (event.item.type === 'message') {
                            this.handleMessage(event.item);
                        }
                        break;

                    case 'conversation.item.input_audio_transcription.completed':
                        this.addTranscript('user', event.transcript);
                        break;

                    case 'response.audio_transcript.delta':
                        this.currentAITranscript += event.delta;
                        break;

                    case 'response.audio_transcript.done':
                        // Defer display to response.done to wait until generation is fully complete
                        // so it appears closer to when AI finishes speaking
                        break;

                    case 'response.done':
                        if (this.currentAITranscript) {
                            // Delay showing the transcript to ensure it appears after the AI voice has likely started/finished
                            const textToShow = this.currentAITranscript;
                            this.currentAITranscript = '';

                            setTimeout(() => {
                                this.addTranscript('ai', textToShow);
                            }, 2500); // 2.5 second delay
                        }
                        console.log('Response completed');
                        break;

                    case 'error':
                        console.error('Server error:', event.error);
                        this.showError(`AI Error: ${event.error.message}`);
                        break;
                }
            }

            handleMessage(item) {
                if (item.role === 'assistant' && item.content) {
                    item.content.forEach(content => {
                        if (content.type === 'audio' && content.transcript) {
                            // This is handled by response.audio_transcript.delta and response.done
                            // We don't want to duplicate transcripts here.
                            // The currentAITranscript logic handles the AI's full response.
                        }
                    });
                }
            }

            addTranscript(role, text) {
                if (!text || text.trim() === '') return;

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;

                // Create content container
                const content = document.createElement('div');
                content.textContent = text;

                // Add styling to match new light/dark themes
                if (role === 'ai') {
                    messageDiv.style.background = '#e0e7ff';
                    messageDiv.style.color = '#1e3a8a';
                    messageDiv.style.alignSelf = 'flex-start';
                    messageDiv.style.borderRadius = '16px 16px 16px 0';
                } else { // user
                    messageDiv.style.background = 'rgb(79, 70, 229)';
                    messageDiv.style.color = 'white';
                    messageDiv.style.alignSelf = 'flex-end';
                    messageDiv.style.borderRadius = '16px 16px 0 16px';
                }

                messageDiv.appendChild(content);
                this.transcriptContent.appendChild(messageDiv);

                // Scroll to bottom
                this.transcriptContent.scrollTop = this.transcriptContent.scrollHeight;

                // Track conversation history for saving to backend
                this.conversationHistory.push({
                    role: role === 'user' ? 'user' : 'assistant',
                    content: text,
                    timestamp: new Date().toISOString()
                });
            }

            toggleMute() {
                if (this.localStream) {
                    this.isMuted = !this.isMuted;
                    this.localStream.getAudioTracks().forEach(track => {
                        track.enabled = !this.isMuted;
                    });
                    this.muteBtn.classList.toggle('active', this.isMuted);
                    this.muteBtn.textContent = this.isMuted ? 'üîá' : 'üé§';
                    this.showToast(this.isMuted ? 'Microphone Muted' : 'Microphone Unmuted', 'default');
                }
            }

            async stopInterview() {
                if (this.interviewTimer) {
                    clearInterval(this.interviewTimer);
                    this.interviewTimer = null;
                }

                // Save conversation to FastAPI backend
                if (this.sessionId && this.conversationHistory.length > 0) {
                    try {
                        const conversationFormData = new FormData();
                        conversationFormData.append('session_id', this.sessionId);
                        conversationFormData.append('conversation_json', JSON.stringify(this.conversationHistory));

                        await fetch(`${FASTAPI_BASE_URL}/aiInterviewManagement/realtime-interview/update-conversation`, {
                            method: 'POST',
                            body: conversationFormData
                        });

                        console.log('Conversation saved to backend');
                    } catch (error) {
                        console.error('Failed to save conversation:', error);
                    }

                    // End the interview session
                    try {
                        const endFormData = new FormData();
                        endFormData.append('session_id', this.sessionId);

                        await fetch(`${FASTAPI_BASE_URL}/aiInterviewManagement/realtime-interview/end`, {
                            method: 'POST',
                            body: endFormData
                        });

                        console.log('Interview session ended on backend');
                    } catch (error) {
                        console.error('Failed to end session on backend:', error);
                    }
                }

                if (this.dataChannel) {
                    this.dataChannel.close();
                }

                if (this.peerConnection) {
                    this.peerConnection.close();
                }

                if (this.localStream) {
                    this.localStream.getTracks().forEach(track => track.stop());
                    this.localStream = null;
                }

                if (this.audioElement) {
                    this.audioElement.srcObject = null;
                }

                // Reset video preview
                this.localVideo.style.display = 'none';
                this.cameraPlaceholder.style.display = 'flex';
                this.devicesReady = false;
                this.checkDevicesBtn.innerHTML = '<span>üîÑ</span> Test Camera & Microphone';
                this.checkDevicesBtn.style.background = ''; // reset to default CSS
                this.deviceStatusText.textContent = '';

                this.isConnected = false;
                // this.updateStatus('Disconnected', false); // Removed status bar
                this.startBtn.disabled = false;
                this.startBtn.innerHTML = '<span>‚ñ∂</span> Start';
                this.liveStopBtn.disabled = true; // Use liveStopBtn
                // this.sessionInfo.textContent = ''; // Removed sessionInfo
                this.timerDisplay.textContent = '00:00'; // Reset timer display
                this.oneMinuteWarningShown = false;
                this.twoMinuteWarningShown = false;
                this.isMuted = false;
                this.muteBtn.classList.remove('active');
                this.muteBtn.textContent = 'üé§';

                this.isCameraOff = false;
                this.camBtn.classList.remove('active');
                this.camBtn.textContent = 'üì∑';

                // Revert Buttons
                this.liveStopBtn.classList.add('hidden');
                this.startBtn.classList.remove('hidden');

                // Show View Results button
                this.viewResultsBtn.classList.remove('hidden');

                this.showSuccess('Interview ended. Thank you!');
            }

            openResults() {
                if (this.sessionId) {
                    const passingScore = 70; // Default passing score
                    window.open(`result.html?session_id=${this.sessionId}&passing_score=${passingScore}`, '_blank');
                }
            }

            updateStatus(text, connected) {
                // this.statusText.textContent = text; // Removed statusText element
                if (connected) {
                    // Update live UI indicators if needed
                    this.checkDevicesBtn.disabled = true;
                    if (this.checkDevicesBtnMain) this.checkDevicesBtnMain.disabled = true;
                } else {
                    this.checkDevicesBtn.disabled = false;
                    if (this.checkDevicesBtnMain) this.checkDevicesBtnMain.disabled = false;
                }
            }

            showError(message) {
                this.showToast(message, 'error');
            }

            hideError() {
                // No-op for toasts
            }

            showSuccess(message) {
                this.showToast(message, 'success');
            }

            hideSuccess() {
                // No-op for toasts
            }

            showToast(message, type = 'default') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast-notification ${type}`;
                // Set border color based on type
                if (type === 'error') toast.style.borderLeftColor = '#ef4444';
                if (type === 'success') toast.style.borderLeftColor = '#10b981';

                toast.innerHTML = `<span>${message}</span>`;

                container.appendChild(toast);

                // Remove after 5 seconds
                setTimeout(() => {
                    toast.style.animation = 'fadeOut 0.3s ease forwards';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 5000);
            }
        }

        const app = new MockInterviewWebRTC();
    </script>
</body>

</html>